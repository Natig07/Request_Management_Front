<main class="h-fit py-4 relative flex flex-col gap-y-5">
    <section class="page-name flex justify-between">
        <h1 class="w-full text-xl font-semibold">Yeni sorğu yarat</h1> 
        <a routerLink="/dashboard/requests"   class="flex  group gap-2 cursor-pointer border-0 px-3 py-2 text-[#6045E2] text-sm">
        <i class="bi opacity-70 bi-chevron-left group-hover:opacity-100"></i>
        <span>Geri</span>
        </a>  
    </section>

    <form (ngSubmit)="onSubmit()" class="request-create-form w-full flex flex-col gap-y-2" [formGroup]="requestForm">
        <div class="cat-prior-type w-full grid grid-cols-3 gap-4">

            <!-- Category -->
            <div class="text-sm flex flex-col gap-y-2">
                <label for="category_id" class="relative w-fit">
                    Kategoriya
                    <i class="bi text-[8px] bi-asterisk text-red-600 absolute top-0 -right-3"></i>
                </label>

                <select
                    id="category_id"
                    formControlName="category"
                    class="border border-black/15 rounded-md px-1.5 py-2 cursor-pointer outline-none focus:ring-1 focus:ring-black/25"
                    >

                    @for (cat of categories; track $index) {
                        <option [value]="cat.id" class="uppercase">{{ cat.name }}</option>
                    }
                </select>

            </div>

            <!-- Priority -->
            <div class="text-sm flex flex-col gap-y-2">
            <label for="priority_id" class="relative w-fit">
                Prioritet
                <i class="bi text-[8px] bi-asterisk text-red-600 absolute top-0 -right-3"></i>
            </label>

            <select
                name="priority_select"
                id="priority_id"
                formControlName="priority"
                class="border border-black/15 capitalize rounded-md px-1.5 py-2 cursor-pointer outline-none focus:ring-1 focus:ring-black/25"
            >
                @for (p of priorities; track p.id) {
                    <option [value]="p.id" class="uppercase">{{ p.name }}</option>
                }
            </select>
            </div>

            <!-- Request Type -->
            <div class="text-sm flex flex-col gap-y-2">
                <label for="req_type_id" class="relative w-fit">
                    Sorğunun tipi
                    <i class="bi text-[8px] bi-asterisk text-red-600 absolute top-0 -right-3"></i>
                </label>

                <select
                    name="request_type_select"
                    id="req_type_id"
                    formControlName="request_type"
                    class="border  border-black/15 capitalize rounded-md px-1.5 py-2 cursor-pointer outline-none  focus:ring-1 focus:ring-black/25"
                >
                    @for (t of requestTypes; track t.id) {
                        <option [value]="t.id" class="uppercase">{{ t.name }}</option>
                    }
                </select>
            </div>

        </div>


        <!-- Header -->
        <div class=" text-sm w-full flex flex-col gap-y-2">
            <label for="header_id" class="relative w-fit ">
                Başlıq
                <i class="bi text-[8px] bi-asterisk text-red-600  absolute -top-0 -right-3"></i>
            </label>

            <input type="text" id="header_id" formControlName="Header" class="border border-black/15 text-gray-600 rounded-md px-1.5 py-2  w-full outline-none focus:ring-1 focus:ring-black/25" >
        </div>

        <!-- Text -->
        <div class="text-sm w-full flex flex-col gap-y-2">
            <label for="request_text_id" class="relative w-fit">
                Mətn
                <i class="bi text-[8px] bi-asterisk text-red-600 absolute top-0 -right-3"></i>
            </label>

            <textarea name="request_text" formControlName="Text" id="request_text_id" class="w-full border border-black/15 rounded-md px-1.5 py-2 text-sm outline-none text-gray-600 focus:ring-1 focus:ring-black/25" rows="6"></textarea>
        </div>

        <!-- File upload -->
         <div class="text-sm w-full flex flex-col gap-y-2">
            <span for="file_upload" class="w-fit">
                Qoşma
            </span>

            <div class="flex w-fit gap-3">
                <div class=" py-2  w-fit">
                <input type="File" name="file_input" id="file_inpt" class="hidden" (change)="onFileSelected($event)">
                <label for="file_inpt" class="cursor-pointer hover:opacity-100 opacity-80">
                    <span class="p-1 border border-black/50  hover:border-black/100 rounded-md">
                        Choose File
                    </span>
               
                </label>
                 @if (selectedFileName!='') {
                    <span class="text-[12px] mx-2">
                    {{selectedFileName}}
                </span>
                }@else {
                    <span class="text-[12px] mx-2">No File Choosen</span>
                }
                </div>
            </div>
         </div>

         <!-- Submit -->
          <div class="w-1/4">
             <button
                type="submit"
                
                class="bg-[#6045E2] w-1/3 text-sm  cursor-pointer  transition duration-300 hover:bg-[#806ce1] text-white py-2 rounded-md"

                >
                @if (!loading) {
                    <span>Göndər</span>
                }
                @if (loading) {
                    <div  class="spinner-border spinner-border-sm text-light" role="status"></div>
                } 
                
                
            </button>
          </div>


    </form>
    <!-- Success message -->
    @if (successMessage) {
        <div
            class="absolute top-0 left-1/2 -translate-x-1/2 right-4 w-fit   bg-green-500 text-white px-4 py-2 rounded-lg shadow-md transition-opacity duration-500">
            <i class="bi bi-check-circle-fill"></i>            
            <span class="mx-2">{{ successMessage }}</span>
        </div>
            
    }

    <!-- Error message -->
     @if (errorMessage) {
       <div
            class="absolute top-4 w-fit left-[2/5] translate-x-1/12 bg-red-500 text-white px-4 py-2 rounded-lg shadow-md transition-opacity duration-500"
            >
            {{ errorMessage }}
        </div>
     }

</main>
